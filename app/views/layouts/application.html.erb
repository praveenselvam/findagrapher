<!DOCTYPE html>
<html xmlns:fb="http://ogp.me/ns/fb#" lang="en">
<html>
<head>
	<meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes" />

  <title>findagrapher - For everyone, for every occasion.</title>

  <!--[if IEMobile]>
  <link rel="stylesheet" href="mobile.css" media="screen" type="text/css"  />
  <![endif]-->
  
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>

  <!--[if IE]>
    <script type="text/javascript">
      var tags = ['header', 'section'];
      while(tags.length)
        document.createElement(tags.pop());
    </script>
  <![endif]-->
</head>
<body>
  <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
	<div id="fb-root"></div>
  <script type="text/javascript">
    window.fbAsyncInit = function() {
      FB.init({
        appId      : "<%= APP_CONFIG[:facebook][:app_id] %>", // App ID
        status     : true,                                    // check login status
        cookie     : true,                                    // enable cookies to allow the server to access the session
        xfbml      : true                                     // parse XFBML
      });

      // Listen to the auth.login which will be called when the user logs in
      // using the Login button
      FB.Event.subscribe('auth.login', function(response) {
        $.ajax({
          url: '/login',
          type: 'post',
          data: {
            access_token: response.authResponse.accessToken
          },
          success: function(){
            console.log('saved. now refresh');
            window.location = window.location;
          }
        });
      });

      FB.Event.subscribe('auth.logout', function(response) {
        window.location = window.location;
      });

      FB.Canvas.setAutoGrow();
    };

    // Load the SDK Asynchronously
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
  <div id="page-bg">
    <header class="clearfix">
      <div class="container">
        <div class="row">
          <div class="logo span4">
            <%= link_to "/" do %>
              <%= image_tag "/assets/logo.png" %>
            <% end %>
          </div>
          <div class="span4 offset4 login-section">
            <% if @user %>
              <ul id="nav-links" class="clearfix">
                <li><%= @user["name"] %></li>
                <li><a href="javascript: void(0);" id="logout">Logoff</a></li>
              </ul>
            <% else %>
              <a href="#photographer-registration" data-toggle="modal" class="btn">Login / Register</a>
            <% end %>
          </div>
        </div>
      </div>
    </header>
    <%= yield %>
  </div>

  <div class="modal hide" id="photographer-registration">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">Ã—</button>
      <h3>Registration for Photographers</h3>
    </div>
    <div class="modal-body">
      <p>
        Good news! findagrapher lets you sign in with your existing facebook account.
      </p>
      <p class="login-section">
        <%= link_to "Login using facebook", new_photographer_path, :class => "btn btn-info", :id => 'login' %>
        <br/>
        <span class="note">
          We don't post anything without your knowledge.
        </span>
      </p>
      <p>
        Register today for free and get in before the competition builds up. Link your existing portfolios, setup alerts & get notified when we come to know of clients of your choice.
      </p>
    </div>
  </div>
</body>
</html>
